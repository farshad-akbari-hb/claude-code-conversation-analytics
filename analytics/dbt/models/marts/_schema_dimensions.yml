# Marts Layer Schema - Dimensions
# Gold layer: Star schema dimension tables

version: 2

models:
  - name: dim_date
    description: |
      Date dimension for temporal analysis.
      Generated date spine with comprehensive temporal attributes.

    columns:
      - name: date_key
        description: "Primary key - the calendar date"
        tests:
          - unique
          - not_null

      - name: year
        description: "4-digit year"
        tests:
          - not_null

      - name: quarter
        description: "Quarter of year (1-4)"
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: [1, 2, 3, 4]

      - name: month
        description: "Month of year (1-12)"
        tests:
          - not_null

      - name: day_of_week
        description: "Day of week (0=Sunday, 6=Saturday)"
        tests:
          - not_null

      - name: is_weekend
        description: "True if Saturday or Sunday"
        tests:
          - not_null

  - name: dim_projects
    description: |
      Project dimension with activity metrics.
      One row per unique project identifier.

    columns:
      - name: project_key
        description: "Surrogate key (MD5 hash of project_id)"
        tests:
          - unique
          - not_null

      - name: project_id
        description: "Natural key - original project identifier"
        tests:
          - unique
          - not_null

      - name: first_seen
        description: "First activity timestamp"
        tests:
          - not_null

      - name: last_active
        description: "Most recent activity timestamp"
        tests:
          - not_null

      - name: session_count
        description: "Number of sessions in this project"
        tests:
          - not_null

      - name: activity_status
        description: "Current activity classification"
        tests:
          - accepted_values:
              arguments:
                values: ['active_today', 'active_this_week', 'active_this_month', 'inactive']

      - name: project_size
        description: "Size classification based on session count"
        tests:
          - accepted_values:
              arguments:
                values: ['single_session', 'small', 'medium', 'large']

  - name: dim_sessions
    description: |
      Session dimension with computed metrics.
      Primary analysis unit for productivity insights.

    columns:
      - name: session_key
        description: "Surrogate key (MD5 hash of session_id)"
        tests:
          - unique
          - not_null

      - name: session_id
        description: "Natural key - original session identifier"
        tests:
          - unique
          - not_null

      - name: project_id
        description: "Foreign key to dim_projects"

      - name: date_key
        description: "Foreign key to dim_date (session start date)"
        tests:
          - relationships:
              to: ref('dim_date')
              field: date_key

      - name: session_start
        description: "Session start timestamp"
        tests:
          - not_null

      - name: session_end
        description: "Session end timestamp"
        tests:
          - not_null

      - name: session_duration_category
        description: "Duration classification"
        tests:
          - accepted_values:
              arguments:
                values: ['quick', 'short', 'medium', 'long']

      - name: activity_level
        description: "Activity classification"
        tests:
          - accepted_values:
              arguments:
                values: ['minimal', 'light', 'moderate', 'heavy']

      - name: session_time_of_day
        description: "Time of day when session started"
        tests:
          - accepted_values:
              arguments:
                values: ['morning', 'afternoon', 'evening', 'night']

      - name: session_day_type
        description: "Weekday or weekend"
        tests:
          - accepted_values:
              arguments:
                values: ['weekday', 'weekend']

  - name: dim_tools
    description: |
      Tool dimension with usage statistics.
      Contains both static metadata and computed metrics.

    columns:
      - name: tool_key
        description: "Surrogate key (MD5 hash of tool_name)"
        tests:
          - unique
          - not_null

      - name: tool_name
        description: "Natural key - tool identifier"
        tests:
          - unique
          - not_null

      - name: tool_category
        description: "Category from seed data"
        tests:
          - not_null
          - accepted_values:
              arguments:
                values:
                  - file_operations
                  - shell
                  - search
                  - agent
                  - planning
                  - network
                  - interaction
                  - unknown

      - name: popularity_rank
        description: "Ranking by total usage"
        tests:
          - not_null

      - name: usage_tier
        description: "Usage frequency classification"
        tests:
          - accepted_values:
              arguments:
                values: ['unused', 'rare', 'occasional', 'frequent', 'heavy']
